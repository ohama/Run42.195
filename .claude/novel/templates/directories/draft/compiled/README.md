# Compiled Output Directory

**Purpose:** Final compiled manuscript and EPUB exports.

**Who Edits:** Generated by `/novel:publish`, but you can edit metadata.yaml directly.

**When Updated:** When publishing to EPUB format.

---

## Contents

| File | Purpose | Edit Manually? |
|------|---------|----------------|
| `metadata.yaml` | EPUB metadata (title, author, description) | Yes - customize before publish |
| `epub.css` | EPUB styling (typography, layout) | Yes - customize appearance |
| `novel.epub` | Generated EPUB file | No - regenerated each publish |

---

## Workflow

### First-Time Setup

1. **Copy templates to this directory:**
   ```bash
   cp .claude/novel/templates/epub/metadata.yaml draft/compiled/
   cp .claude/novel/templates/epub/epub.css draft/compiled/
   ```

2. **Edit metadata.yaml:**
   - Fill in your book title
   - Add author name
   - Write description/synopsis
   - Set language code (ko, en, ja, etc.)
   - Add cover image path if available

3. **Customize epub.css (optional):**
   - Adjust font choices
   - Modify line height
   - Customize scene break styling

### Publishing

1. **Ensure scenes are approved:**
   ```
   /novel:status
   ```
   Check that scenes have "approved" status.

2. **Run publish command:**
   ```
   /novel:publish
   ```
   This generates `novel.epub` from approved scenes.

3. **Verify output:**
   - Open `novel.epub` in an e-reader app
   - Check table of contents navigation
   - Verify chapter breaks are correct
   - Test on target devices (Kindle, Kobo, etc.)

---

## Metadata Source

The `metadata.yaml` file can be initialized automatically from `canon/premise.md`:

- **Title** extracted from "Title:" line
- **Author** extracted from "Author:" line
- **Description** extracted from "Logline:" or "Synopsis:"
- **Language** from `style_state.json` (defaults to "ko")

After initialization, you can edit `metadata.yaml` manually for finer control over EPUB metadata.

---

## Regeneration

Running `/novel:publish` will:

1. Recompile all approved scenes in reading order
2. Regenerate `novel.epub` (overwrites previous version)
3. Report scene count and file size

**Previous versions are NOT automatically backed up.**

For version history:
- Use git commits before regenerating
- Copy to `draft/versions/` for milestones
- Example: `cp novel.epub ../versions/v1_first_draft.epub`

---

## Requirements

### Pandoc (Required)

Pandoc must be installed to generate EPUB files.

**Check installation:**
```bash
pandoc --version
```

**Install Pandoc:**
- Debian/Ubuntu: `sudo apt-get install pandoc`
- macOS: `brew install pandoc`
- Windows: `choco install pandoc`
- Download: https://pandoc.org/installing.html

**Minimum version:** 2.0 (for EPUB3 support)

### epubcheck (Optional)

For EPUB validation:
- Download: https://github.com/w3c/epubcheck
- Run: `epubcheck novel.epub`

---

## File Details

### metadata.yaml

EPUB metadata in YAML format (Pandoc's EPUB extension).

**Required fields:**
- `title` - Book title
- `creator` - Author name
- `language` - ISO 639-1 code (ko, en, ja, zh)

**Recommended fields:**
- `identifier` - UUID for book identity
- `description` - Synopsis for e-reader catalogs
- `rights` - Copyright notice
- `date` - Publication date (YYYY-MM-DD)
- `cover-image` - Path to cover graphic

### epub.css

Custom stylesheet for EPUB typography.

**Key selectors:**
- `body` - Base font and line height
- `h1` - Chapter heading style
- `hr` - Scene break decoration
- `p` - Paragraph indentation
- `:lang(ko)` - Korean text optimization
- `blockquote` - Internal monologue/letters

### novel.epub

Generated EPUB3 file, readable by:
- Apple Books
- Kindle (via Send to Kindle)
- Kobo
- Google Play Books
- Calibre
- Most e-reader devices

---

## Troubleshooting

| Issue | Solution |
|-------|----------|
| "Pandoc not found" | Install Pandoc (see Requirements) |
| "No approved scenes" | Run `/novel:check` to approve scenes |
| Empty EPUB | Check `story_state.json` has scenes |
| Missing chapters | Verify scene files exist in `draft/scenes/` |
| Wrong order | Check chapter/scene numbers in `scene_index` |
| Styling issues | Edit `epub.css`, test in Calibre |

---

## Cover Image

For best results:
- **Size:** 1000x1500 pixels (2:3 aspect ratio)
- **Format:** PNG or JPEG
- **Location:** `images/cover.png` or `images/cover.jpg`
- **Set in metadata.yaml:** `cover-image: "images/cover.png"`

If no cover is provided, the EPUB will be generated without one.

---

*Generated by Novel Engine*
*See .claude/novel/skills/epub-generator.md for technical details*
